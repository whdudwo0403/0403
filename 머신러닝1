# [1] ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.neighbors import KNeighborsRegressor
from sklearn.metrics import mean_absolute_error, r2_score
import matplotlib.pyplot as plt
import seaborn as sns

# [2] CSV íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv("card_gyeonggi_202503 2.csv")  # ì •í™•í•œ íŒŒì¼ëª… ì‚¬ìš©!

# [3] ì»¬ëŸ¼ëª… ì •ë¦¬ (í•œê¸€ ê·¸ëŒ€ë¡œ)
df.columns = ['ë‚ ì§œ', 'ì—…ì¢…', 'ì„±ë³„', 'ì—°ë ¹ëŒ€', 'ìš”ì¼', 'ë§¤ì¶œê¸ˆì•¡', 'ë§¤ì¶œê±´ìˆ˜']

# [4] ì‚¬ìš©í•  ì—´ë§Œ ì¶”ì¶œ
data = df[['ì„±ë³„', 'ìš”ì¼', 'ë§¤ì¶œê¸ˆì•¡']].dropna()

# [5] ì…ë ¥(X), ì¶œë ¥(y) ë‚˜ëˆ„ê¸°
X = pd.get_dummies(data[['ì„±ë³„', 'ìš”ì¼']])  # ì›í•« ì¸ì½”ë”©
y = data['ë§¤ì¶œê¸ˆì•¡']

# [6] í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë¶„ë¦¬
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# [7] ëª¨ë¸ í•™ìŠµ - ì„ í˜• íšŒê·€
lr = LinearRegression()
lr.fit(X_train, y_train)
lr_pred = lr.predict(X_test)

# [8] ëª¨ë¸ í•™ìŠµ - KNN íšŒê·€
knn = KNeighborsRegressor()
knn.fit(X_train, y_train)
knn_pred = knn.predict(X_test)

# [9] ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ ì¶œë ¥
print("ğŸ”¹ ì„ í˜• íšŒê·€")
print("RÂ²:", r2_score(y_test, lr_pred))
print("MAE:", mean_absolute_error(y_test, lr_pred))

print("\nğŸ”¹ KNN íšŒê·€")
print("RÂ²:", r2_score(y_test, knn_pred))
print("MAE:", mean_absolute_error(y_test, knn_pred))

# [10] ìš”ì¼ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡ ì‹œê°í™” (ì˜ì–´ ë¼ë²¨)
plt.figure(figsize=(10,6))
sns.barplot(x='ìš”ì¼', y='ë§¤ì¶œê¸ˆì•¡', data=data, estimator=np.mean, ci=None)

plt.title("Average Sales Amount by Day of Week")
plt.xlabel("Day of Week (1 = Mon, ..., 7 = Sun)")
plt.ylabel("Average Sales Amount (KRW)")
plt.tight_layout()
plt.show()
